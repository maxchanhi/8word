<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Daily Horoscope Fortune Teller</title> <!-- Changed Title -->
    <meta name="description" content="Get your free daily horoscope prediction using AI. Enter your zodiac sign for insights."> <!-- Changed Description -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1144455372936156"
     crossorigin="anonymous"></script>
</head>
<body>
    <h1>AI Daily Horoscope Fortune Teller</h1> <!-- Changed Heading -->
    <div>
        <p>Please provide your Zodiac Sign (e.g., Aries, Taurus, Gemini...) or birthday to get your daily horoscope prediction.</p> <!-- Changed Instructions -->
    </div>
    <input type="text" id="messageInput" placeholder="Enter your Zodiac Sign"> <!-- Changed Placeholder -->
    <button id="sendButton" onclick="sendMessage()">Get Horoscope</button> <!-- Changed Button Text -->

    <div class="spinner" id="loadingSpinner"></div>
    <div id="displayMessage"></div>
    <br>
    <p style="text-align: center;">Enjoying the horoscope? Consider supporting:</p> <!-- Changed Text -->
    <div style="text-align: center;"><script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="maxchanhi" data-color="#FFDD00" data-emoji="" data-font="Arial" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script></div>

    <script>
        function sendMessage() {
            const text = document.getElementById("messageInput").value.trim(); // Trim whitespace
            const displayElement = document.getElementById("displayMessage");
            const spinnerElement = document.getElementById("loadingSpinner");
            const sendButton = document.getElementById("sendButton");

            sendButton.disabled = true;
            displayElement.innerHTML = '';
            displayElement.style.display = 'none';
            spinnerElement.style.display = 'block';

            // Basic validation for zodiac sign (can be improved)
            if (!text || text.length < 3 || text.length > 40) { // Adjusted validation
                 console.log("Input is empty or invalid length. Message not sent.");
                 displayElement.innerText = "Please enter a valid Zodiac Sign (e.g., Leo)."; // Changed Error Message
                 displayElement.style.display = 'block';
                 spinnerElement.style.display = 'none';
                 sendButton.disabled = false;
                 return;
            }

            // Updated fetch URL to /horoscope
            fetch("/horoscope", { // Changed Endpoint
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text }) // Sending the zodiac sign as 'text'
            })
            .then(response => {
                 if (response.status === 429) {
                     // Use English for the error message
                     return response.json().then(err => { throw new Error(err.message || "Hourly request limit reached.") });
                 }
                 if (!response.ok) {
                     return response.json().then(err => { throw new Error(err.error || `HTTP error! status: ${response.status}`) });
                 }
                 return response.json();
            })
            .then(data => {
                spinnerElement.style.display = 'none';
                // Ensure marked is used correctly if response is markdown
                displayElement.innerHTML = '<strong>Horoscope:</strong><br>' + marked.parse(data.aiResponse);
                displayElement.style.display = 'block';
            })
            .catch(error => {
                console.error("Error:", error);
                spinnerElement.style.display = 'none';
                displayElement.innerText = `Error: ${error.message}`;
                displayElement.style.display = 'block';
            })
            .finally(() => {
                sendButton.disabled = false;
            });
        }
    </script>
</body>
</html>
